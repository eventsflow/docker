variables:
  DOCKER_TLS_CERTDIR: "/certs"
  
services:
  - docker:19.03.12-dind

include:
  - template: Container-Scanning.gitlab-ci.yml
  
before_script:
  - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY

stages:
  - build
  - test

base_images:
  image: docker:stable
  stage: build
  # stage: base_images
  script:
    - ./scripts/manage.sh build base
    - ./scripts/manage.sh test base
    - ./scripts/manage.sh publish-to-gitlab-registry base

  
# dev_images:
#   image: docker:stable
#   stage: dev_images
#   script:
#      - ./scripts/manage.sh build dev
#      - ./scripts/manage.sh test dev
#      - ./scripts/manage.sh publish-to-gitlab-registry dev
